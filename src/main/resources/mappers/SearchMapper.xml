<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--ItemMapper의 위치를 적어줌-->
<mapper namespace="shop.RecommendSystem.repository.mapper.SearchMapper">

    <!--글 상세 보기-->
    <select id="findSearchTarget" resultType="ImageInfo">
        SELECT image_uuid,
               image_hash_code
        FROM image_info
    </select>

    <!-- SELECT 쿼리 -->
    <select id="findItemCandidates" parameterType="list" resultType="SearchResult">
        SELECT
        s.item_id, s.item_title, s.item_price, i.image_url, i.image_uuid
        FROM
        shop_board AS s
        LEFT JOIN
        image_info AS i
        ON
        s.item_image_link = i.image_uuid
        WHERE
        i.image_uuid IN
        <foreach item="item" index="index" collection="list" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="findImageColorTag" parameterType="String" resultType="String">
        SELECT GROUP_CONCAT(color_tag SEPARATOR ',') AS color_tags
        FROM image_color_tag
        WHERE image_color_uuid IN (SELECT image_uuid from image_info where image_hash_code = #{imageColorUuid})

        GROUP BY image_color_uuid;
    </select>
    <select id="findImageColorTagByuuid" parameterType="String" resultType="String">
        SELECT GROUP_CONCAT(color_tag SEPARATOR ',') AS color_tags
        FROM image_color_tag
        WHERE image_color_uuid = #{imageColorUuid}

        GROUP BY image_color_uuid;
    </select>


    <select id="findImageColorTags" parameterType="list" resultMap="imageColorTagsMap">
        SELECT
        image_color_uuid,
        GROUP_CONCAT(color_tag SEPARATOR ',') AS color_tags
        FROM
        image_color_tag
        WHERE
        image_color_uuid IN
        <foreach item="imageColorUuid" collection="list" open="(" separator="," close=")">
            #{imageColorUuid}
        </foreach>
        GROUP BY
        image_color_uuid;
    </select>


    <resultMap id="imageColorTagsMap" type="java.util.HashMap">
        <id property="image_color_uuid" column="image_color_uuid"/>
        <result property="color_tags" column="color_tags"/>
    </resultMap>

</mapper>