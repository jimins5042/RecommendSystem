<!DOCTYPE html>
<html lang="en">

<head>
    <!-- 헤더 파일 포함 -->
    <head th:replace="fragments/header :: header"/>

    <style>

        .card {
            width: 100%;
            /*height: 400px;*/
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-img-top {
            width: 100%;
            height: 200px; /* 이미지 높이 고정 */
            object-fit: cover; /* 이미지 비율 유지하며 카드에 맞게 자르기 */
        }

        .card-body {
            height: 100px; /* 카드 본문 높이 */
            text-align: center;
            padding: 10px;
        }


        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination a {
            padding: 8px 16px;
            margin: 0 4px;
            border: 1px solid #ddd;
            text-decoration: none;
        }

        .pagination a:hover {
            background-color: #f1f1f1;
        }

        .pagination .active {
            background-color: #007bff;
            color: white;
        }

        tr:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }

        .container {
            position: relative;
        }
    </style>
</head>

<body>
<!-- Navigation -->

<div th:replace="fragments/bodyHeader :: bodyHeader"></div>

<!-- Search Bar -->
<div class="container mt-4">
    <form class="d-flex align-items-center">
        <input class="form-control me-2" type="text" name="query" placeholder="검색어를 입력하세요"
               aria-label="Search" style="max-width: 400px;">

        <button class="btn btn-outline-dark me-3" type="submit">검색</button>
    </form>

    <form th:action="@{/search/img}" method="post" enctype="multipart/form-data">

        <!-- 이미지 업로드 -->
        <div class="form-group">
            <label for="imgFile">상품 이미지</label>
            <input type="file" name="imgFile" id="imgFile" class="form-control-file"
                   accept="image/*">
        </div>

        <!-- 제출 버튼 -->
        <button type="submit" class="btn btn-primary mt-3">등록</button>
    </form>
</div>

<!-- Section -->
<section class="py-5" style="margin-top: -100px;" th:if="${items != null}">
    <div class="container px-4 px-lg-5 mt-5">
        <div class="py-5 text-center">
            <h2>오늘의 추천 상품</h2>
            <h6>이미지 검색으로 원하는 상품을 추천 받으세요</h6>
        </div>
        <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
            <!-- Thymeleaf loop for products -->
            <div class="col mb-5" th:each="item : ${items}">
                <div class="card h-100">
                    <!-- Product image -->
                    <a th:href="@{/shop/detail/{id}(id=${item.itemId})}">

                        <img class="card-img-top img-fluid" th:if="${item.itemImageLink != null}"
                             th:src="${item.itemImageLink}"
                             th:alt="${item.itemTitle}" loading="lazy"
                             style="max-width: 400px; max-height: 400px;">
                        <!--style="width: 350px; height: 400px; object-fit: cover;"-->

                        <p th:if="${item.itemImageLink == null}">이미지가 없습니다.</p>

                    </a>
                    <!-- Product details -->
                    <div class="card-body p-4">
                        <div class="text-center">
                            <!-- Product name -->
                            <h5 class="fw-bolder" th:text="${item.itemTitle}"></h5>
                            <!-- Product price -->
                            <span th:text="${item.itemPrice} + ' 원'"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 페이지네이션 -->
        <div class="pagination">
            <ul class="pagination">
                <!-- 이전 페이지 -->
                <li th:if="${pageDto.pageNo > 9}">
                    <a th:href="@{/shop/main(page=${(pageDto.pageNo / 10 - 1) * 10 + 1})}"
                       aria-label="Previous">&laquo;</a>
                </li>

                <!-- 페이지 번호들 -->
                <li th:each="i : ${#numbers.sequence(pageDto.startPage, pageDto.endPage)}">
                    <a th:href="@{/shop/main(page=${i})}" th:text="${i}"
                       th:classappend="${i == pageDto.pageNo} ? 'active' : ''"></a>
                </li>

                <!-- 다음 페이지 -->
                <li th:if="${pageDto.pageNo < pageDto.totalPages}">
                    <a th:href="@{/shop/main(page=${(pageDto.pageNo / 10 + 1) * 10 + 1})}" aria-label="Next">&raquo;</a>
                </li>
            </ul>
        </div>

        <!-- More button -->
        <div class="text-sm-end">
            <a class="btn btn-outline-dark mt-auto" href="/list">더보기</a>
        </div>
    </div>
</section>

<section class="py-5" style="margin-top: 10px;" th:if="${results != null}">
    <div class="container px-4 px-lg-5 mt-5">
        <div class="py-5 text-center">

            <h4>📢 현재 보시는 상품과 시각적으로 유사한 상품들이에요 📢</h4>
        </div>
        <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">

            <div class="col mb-5" th:each="result : ${results}">
                <div class="card h-100">
                    <a th:href="@{/shop/detail/{itemId}(itemId=${result.itemId})}">
                        <img class="card-img-top img-fluid"
                             th:src="${result.imageUrl != null ? result.imageUrl : '/images/default.jpg'}"
                             th:alt="${result.itemTitle != null ? result.itemTitle : '상품 이미지'}"
                             loading="lazy" style="max-width: 400px;">
                    </a>
                    <div class="card-body p-4">
                        <div class="text-center">
                            <h5 class="fw-bolder"
                                th:text="${result.itemTitle != null ? result.itemTitle : '상품 제목 없음'}"></h5>
                            <span th:text="${result.itemPrice != null ? result.itemPrice + ' 원' : '가격 없음'}"></span>
                            <br>
                            <span th:text="${result.hammingDistance != null ? '유사도: ' + result.hammingDistance : '유사도 정보 없음'}"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Footer -->
<footer class="py-5 bg-dark">
    <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p>
    </div>
</footer>
</body>

</html>
